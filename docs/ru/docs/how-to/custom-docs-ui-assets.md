# Пользовательские статические ресурсы Docs UI (самостоятельный хостинг)

API документация использует **Swagger UI** и **ReDoc**, и каждому из них требуются некоторые файлы JavaScript и CSS.

По умолчанию эти файлы предоставляются через <abbr title="Сеть доставки контента: служба, обычно состоящая из нескольких серверов, которая предоставляет статические файлы, такие как JavaScript и CSS. Обычно используется для доставки этих файлов с сервера, наиболее близкого к клиенту, что улучшает производительность.">CDN</abbr>.

Но возможно его настроить: можно установить определенный CDN или разместить файлы самостоятельно.

## Пользовательский CDN для JavaScript и CSS

Предположим, что вы хотите использовать другой <abbr title="Сеть доставки контента">CDN</abbr>, например, хотите использовать `https://unpkg.com/`.

Это может быть полезно, если, например, вы живете в стране, где некоторые URL-адреса ограничены.

### Отключение автоматической документации

Первый шаг — отключить автоматическую документацию, так как по умолчанию они используют стандартный CDN.

Чтобы отключить их, установите их URL в `None` при создании вашего приложения `FastAPI`:

{* ../../docs_src/custom_docs_ui/tutorial001.py hl[8] *}

### Включение пользовательской документации

Теперь вы можете создать *path operations* для пользовательской документации.

Вы можете повторно использовать внутренние функции FastAPI для создания HTML-страниц документации и передавать им необходимые аргументы:

* `openapi_url`: URL-адрес, по которому HTML-страница документации может получить схему OpenAPI вашего API. Здесь можно использовать атрибут `app.openapi_url`.
* `title`: заголовок вашего API.
* `oauth2_redirect_url`: здесь можно использовать `app.swagger_ui_oauth2_redirect_url`, чтобы использовать стандартный.
* `swagger_js_url`: URL-адрес, по которому HTML вашей документации на Swagger UI может получить файл **JavaScript**. Это пользовательский URL-адрес CDN.
* `swagger_css_url`: URL-адрес, по которому HTML вашей документации на Swagger UI может получить файл **CSS**. Это пользовательский URL-адрес CDN.

И аналогично для ReDoc...

{* ../../docs_src/custom_docs_ui/tutorial001.py hl[2:6,11:19,22:24,27:33] *}

/// tip | Совет

*Path operation* для `swagger_ui_redirect` является помощником, когда вы используете OAuth2.

Если вы интегрируете свой API с провайдером OAuth2, вы сможете авторизоваться и вернуться к документации API с полученными учетными данными. И взаимодействовать с ним, используя реальную аутентификацию через OAuth2.

Swagger UI сделает это для вас за кулисами, но для этого нужен этот помощник "перенаправления".

///

### Создание *path operation* для его тестирования

Теперь, чтобы проверить, что все работает, создайте *path operation*:

{* ../../docs_src/custom_docs_ui/tutorial001.py hl[36:38] *}

### Тестирование

Теперь вы должны иметь возможность перейти на свою документацию по адресу <a href="http://127.0.0.1:8000/docs" class="external-link" target="_blank">http://127.0.0.1:8000/docs</a> и перезагрузить страницу, она загрузит эти ресурсы с нового CDN.

## Самостоятельный хостинг JavaScript и CSS для документации

Самостоятельный хостинг JavaScript и CSS может быть полезен, если, например, вам нужно, чтобы ваше приложение продолжало работать даже в автономном режиме, без доступа в интернет или в локальной сети.

Здесь вы увидите, как самостоятельно размещать эти файлы в том же приложении FastAPI и настраивать документацию для их использования.

### Структура файлов проекта

Допустим, ваша структура файлов проекта выглядит следующим образом:

```
.
├── app
│   ├── __init__.py
│   ├── main.py
```

Теперь создайте каталог для хранения этих статических файлов.

Ваша новая структура файлов может выглядеть так:

```
.
├── app
│   ├── __init__.py
│   ├── main.py
└── static/
```

### Загрузка файлов

Скачайте необходимые для документации статические файлы и поместите их в каталог `static/`.

Вы можете щелкнуть правой кнопкой мыши по каждой ссылке и выбрать опцию, аналогичную `Сохранить ссылку как...`.

**Swagger UI** использует файлы:

* <a href="https://cdn.jsdelivr.net/npm/swagger-ui-dist@5/swagger-ui-bundle.js" class="external-link" target="_blank">`swagger-ui-bundle.js`</a>
* <a href="https://cdn.jsdelivr.net/npm/swagger-ui-dist@5/swagger-ui.css" class="external-link" target="_blank">`swagger-ui.css`</a>

А **ReDoc** использует файл:

* <a href="https://cdn.jsdelivr.net/npm/redoc@2/bundles/redoc.standalone.js" class="external-link" target="_blank">`redoc.standalone.js`</a>

После этого ваша структура файлов может выглядеть так:

```
.
├── app
│   ├── __init__.py
│   ├── main.py
└── static
    ├── redoc.standalone.js
    ├── swagger-ui-bundle.js
    └── swagger-ui.css
```

### Обслуживание статических файлов

* Импортируйте `StaticFiles`.
* "Подключите" экземпляр `StaticFiles()` в определенном пути.

{* ../../docs_src/custom_docs_ui/tutorial002.py hl[7,11] *}

### Тестирование статических файлов

Запустите приложение и перейдите по адресу <a href="http://127.0.0.1:8000/static/redoc.standalone.js" class="external-link" target="_blank">http://127.0.0.1:8000/static/redoc.standalone.js</a>.

Вы должны увидеть очень длинный JavaScript файл для **ReDoc**.

Он может начинаться с чего-то вроде:

```JavaScript
/*! For license information please see redoc.standalone.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("null")):
...
```

Это подтверждает, что вы можете обслуживать статические файлы из вашего приложения и что вы разместили статические файлы для документации в правильном месте.

Теперь мы можем настроить приложение для использования этих статических файлов в документации.

### Отключение автоматической документации для статических файлов

Как и при использовании пользовательского CDN, первым шагом является отключение автоматической документации, так как по умолчанию они используют CDN.

Чтобы отключить их, установите их URL в `None` при создании вашего приложения `FastAPI`:

{* ../../docs_src/custom_docs_ui/tutorial002.py hl[9] *}

### Включение пользовательской документации для статических файлов

И так же, как с пользовательским CDN, теперь вы можете создать *path operations* для пользовательской документации.

Снова можно использовать внутренние функции FastAPI для создания HTML-страниц документации и передавать им необходимые аргументы:

* `openapi_url`: URL-адрес, по которому HTML-страница документации может получить схему OpenAPI вашего API. Здесь можно использовать атрибут `app.openapi_url`.
* `title`: заголовок вашего API.
* `oauth2_redirect_url`: здесь можно использовать `app.swagger_ui_oauth2_redirect_url`, чтобы использовать стандартный.
* `swagger_js_url`: URL-адрес, по которому HTML вашей документации на Swagger UI может получить файл **JavaScript**. **Это файл, который ваше приложение теперь обслуживает**.
* `swagger_css_url`: URL-адрес, по которому HTML вашей документации на Swagger UI может получить файл **CSS**. **Это файл, который ваше приложение теперь обслуживает**.

И аналогично для ReDoc...

{* ../../docs_src/custom_docs_ui/tutorial002.py hl[2:6,14:22,25:27,30:36] *}

/// tip | Совет

*Path operation* для `swagger_ui_redirect` является помощником, когда вы используете OAuth2.

Если вы интегрируете свой API с провайдером OAuth2, вы сможете авторизоваться и вернуться к документации API с полученными учетными данными. И взаимодействовать с ним, используя реальную аутентификацию через OAuth2.

Swagger UI сделает это для вас за кулисами, но для этого нужен этот помощник "перенаправления".

///

### Создание *path operation* для тестирования статических файлов

Теперь, чтобы убедиться, что все работает, создайте *path operation*:

{* ../../docs_src/custom_docs_ui/tutorial002.py hl[39:41] *}

### Тестирование статических файлов UI

Теперь вы должны иметь возможность отключить Wi-Fi, перейти на свою документацию по адресу <a href="http://127.0.0.1:8000/docs" class="external-link" target="_blank">http://127.0.0.1:8000/docs</a> и перезагрузить страницу.

И даже без Интернета вы сможете увидеть документацию вашего API и взаимодействовать с ней.
