# Условный OpenAPI

Если потребуется, вы можете использовать настройки и переменные окружения, чтобы условно настраивать OpenAPI в зависимости от окружения, и даже полностью отключать его.

## О безопасности, API и документации

Скрытие пользовательских интерфейсов вашей документации в продакшне *не должно* быть способом защиты вашего API.

Это не добавляет никакой дополнительной безопасности вашему API, *операции пути* по-прежнему будут доступны там, где они есть.

Если в вашем коде есть уязвимость, она всё равно будет существовать.

Скрытие документации лишь затрудняет понимание того, как взаимодействовать с вашим API, и может усложнить его отладку в продакшне. Это может рассматриваться просто как форма <a href="https://en.wikipedia.org/wiki/Security_through_obscurity" class="external-link" target="_blank">безопасности через неясность</a>.

Если вы хотите защитить ваш API, есть несколько более эффективных подходов:

* Убедитесь, что у вас есть хорошо определённые Pydantic-модели для тел запросов и ответов.
* Настройте необходимые разрешения и роли с использованием зависимостей.
* Никогда не храните пароли в открытом виде, только хеши паролей.
* Реализуйте и используйте известные криптографические инструменты, такие как Passlib и JWT токены и т. д.
* Добавьте более детальный контроль разрешений с помощью OAuth2 областей, где это необходимо.
* ...и так далее.

Тем не менее, может быть очень специфический случай, когда вам действительно нужно отключить документацию API для какого-то окружения (например, для продакшна) или в зависимости от настроек из переменных окружения.

## Условный OpenAPI из настроек и переменных окружения

Вы можете легко использовать те же настройки Pydantic для конфигурации вашего сгенерированного OpenAPI и интерфейсов документации.

Например:

{* ../../docs_src/conditional_openapi/tutorial001.py hl[6,11] *}

Здесь мы объявляем настройку `openapi_url` с тем же значением по умолчанию `"/openapi.json"`.

Затем мы используем его при создании приложения `FastAPI`.

Затем вы можете отключить OpenAPI (включая документацию UI) путем установки значения переменной окружения `OPENAPI_URL` в пустую строку, так:

<div class="termy">

```console
$ OPENAPI_URL= uvicorn main:app

<span style="color: green;">INFO</span>:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
```

</div>

Затем, если вы перейдете по URL-адресам `/openapi.json`, `/docs` или `/redoc`, вы получите ошибку `404 Not Found`, например:

```JSON
{
    "detail": "Not Found"
}
```
