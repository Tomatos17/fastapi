# Продвинутые зависимости

## Параметризуемые зависимости

Все зависимости, которые мы видели, являются фиксированной функцией или классом.

Но могут быть случаи, когда вы захотите иметь возможность задавать параметры для зависимости, не объявляя множество разных функций или классов.

Представим, что мы хотим иметь зависимость, которая проверяет, содержит ли параметр запроса `q` некоторое фиксированное содержимое.

Но нам нужно иметь возможность параметризовать это фиксированное содержимое.

## "Вызываемый" экземпляр

В Python есть способ сделать экземпляр класса "вызываемым".

Не сам класс (он уже может быть вызываемым), а экземпляр этого класса.

Для этого мы объявляем метод `__call__`:

{* ../../docs_src/dependencies/tutorial011_an_py39.py hl[12] *}

В этом случае **FastAPI** будет использовать этот `__call__` для проверки дополнительных параметров и под-зависимостей, и он будет вызываться для передачи значения в параметр вашей *функции-обработчика пути* позже.

## Параметризация экземпляра

Теперь мы можем использовать `__init__`, чтобы объявить параметры экземпляра, которые мы можем использовать для "параметризации" зависимости:

{* ../../docs_src/dependencies/tutorial011_an_py39.py hl[9] *}

В данном случае **FastAPI** никогда не будет касаться или заботиться об `__init__`, мы будем использовать его напрямую в нашем коде.

## Создание экземпляра

Мы можем создать экземпляр этого класса с помощью:

{* ../../docs_src/dependencies/tutorial011_an_py39.py hl[18] *}

Таким образом, мы можем "параметризовать" нашу зависимость, в которой теперь есть `"bar"`, как атрибут `checker.fixed_content`.

## Использование экземпляра в качестве зависимости

Затем мы могли бы использовать этот `checker` в `Depends(checker)`, вместо `Depends(FixedContentQueryChecker)`, потому что зависимость — это экземпляр `checker`, а не сам класс.

И при разрешении зависимости, **FastAPI** вызовет этот `checker` так:

```Python
checker(q="somequery")
```

...и передаст то, что это возвращает, как значение зависимости в нашей *функции-обработчике пути* как параметр `fixed_content_included`:

{* ../../docs_src/dependencies/tutorial011_an_py39.py hl[22] *}

/// tip | Совет

Все это может показаться надуманным. И пока не совсем ясно, насколько это полезно.

Эти примеры намеренно просты, но показывают, как все работает.

В главах о безопасности есть утилиты-функции, которые реализованы таким же образом.

Если вы все это поняли, вы уже знаете, как работают эти утилиты для безопасности изнутри.

///
