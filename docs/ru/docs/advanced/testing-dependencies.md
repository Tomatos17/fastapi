# Тестирование зависимостей с использованием переопределений

## Переопределение зависимостей в процессе тестирования

Существуют сценарии, когда вам может понадобиться переопределить зависимость во время тестирования.

Вы не хотите, чтобы оригинальная зависимость выполнялась (также как и любые её подзависимости).

Вместо этого, вы хотите предоставить другую зависимость, которая будет использоваться только во время тестов (возможно, только для некоторых конкретных тестов), и будет предоставлять значение, которое можно использовать там, где использовалось значение оригинальной зависимости.

### Примеры использования: внешний сервис

Примером может служить ситуация, когда у вас есть внешний провайдер аутентификации, которого вам необходимо вызывать.

Вы отправляете ему токен, и он возвращает аутентифицированного пользователя.

Этот провайдер может брать плату за каждый запрос, и вызов его может занять больше времени, чем если бы вы использовали фиксированного пользователя-мока для тестов.

Вероятно, вы захотите протестировать внешнего провайдера один раз, но не обязательно вызывать его для каждого теста, который вы запускаете.

В этом случае вы можете переопределить зависимость, которая вызывает этого провайдера, и использовать пользовательскую зависимость, которая возвращает мока-пользователя, только для ваших тестов.

### Использование атрибута `app.dependency_overrides`

В таких случаях ваше приложение **FastAPI** имеет атрибут `app.dependency_overrides`, который является простым `dict`.

Чтобы переопределить зависимость для тестирования, вы указываете оригинальную зависимость (функцию) в качестве ключа, и ваше переопределение зависимости (другую функцию) в качестве значения.

Затем **FastAPI** будет вызывать это переопределение вместо оригинальной зависимости.

{* ../../docs_src/dependency_testing/tutorial001_an_py310.py hl[26:27,30] *}

/// tip | Совет

Вы можете установить переопределение зависимости для зависимости, используемой в любом месте вашего приложения **FastAPI**.

Оригинальная зависимость может использоваться в *функции-обработчике пути*, *декораторе операции пути* (если вы не используете возвращаемое значение), вызове `.include_router()`, и т. д.

FastAPI все равно сможет ее переопределить.

///

Затем вы можете сбросить ваши переопределения (удалить их), установив `app.dependency_overrides` в пустой `dict`:

```Python
app.dependency_overrides = {}
```

/// tip | Совет

Если вы хотите переопределить зависимость только в некоторых тестах, вы можете установить переопределение в начале теста (внутри тестовой функции) и сбросить его в конце (в конце тестовой функции).

///
