# Тестирование зависимостей с переопределением

## Переопределение зависимостей во время тестирования

Существуют сценарии, когда вы можете захотеть переопределить зависимость во время тестирования.

Вы не хотите, чтобы изначальная зависимость запускалась (а также любые ее подзависимости).

Вместо этого вы хотите предоставить другую зависимость, которая будет использоваться только во время тестов (возможно, только для некоторых конкретных тестов) и будет предоставлять значение, которое можно использовать там, где использовалось значение первоначальной зависимости.

### Примеры использования: внешний сервис

Примером может быть наличие внешнего поставщика аутентификации, которого вам нужно вызывать.

Вы отправляете ему токен, и он возвращает аутентифицированного пользователя.

Этот поставщик может взимать плату за каждый запрос, и его вызов может занимать больше времени, чем если бы вы использовали заранее заданного пользователя-симулятора для тестов.

Вы, вероятно, захотите протестировать внешнего поставщика один раз, но не обязательно вызывать его для каждого выполняемого теста.

В этом случае вы можете переопределить зависимость, которая вызывает этого поставщика, и использовать пользовательскую зависимость, которая возвращает пользователя-симулятора, только для ваших тестов.

### Использование атрибута `app.dependency_overrides`

Для таких случаев ваше приложение **FastAPI** имеет атрибут `app.dependency_overrides`, который представляет собой простой `dict`.

Чтобы переопределить зависимость для тестирования, вы используете в качестве ключа оригинальную зависимость (функцию), а в качестве значения — функцию-переопределение вашей зависимости.

Затем **FastAPI** вызовет это переопределение вместо оригинальной зависимости.

{* ../../docs_src/dependency_testing/tutorial001_an_py310.py hl[26:27,30] *}

/// tip | Совет

Вы можете задать переопределение зависимости для зависимости, используемой где угодно в вашем приложении **FastAPI**.

Изначальная зависимость может использоваться в *функции операции пути*, *декораторе операции пути* (когда вы не используете возвращаемое значение), вызове `.include_router()` и т. д.

FastAPI все равно сможет переопределить ее.

///

Затем вы можете сбросить свои переопределения (удалить их), установив `app.dependency_overrides` в пустой `dict`:

```Python
app.dependency_overrides = {}
```

/// tip | Совет

Если вы хотите переопределить зависимость только во время некоторых тестов, вы можете установить переопределение в начале теста (внутри функции теста) и сбросить его в конце (в конце функции теста).

///
